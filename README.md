# esp32-wb-led
Modbus controller for WirenBoard WB-LED dimmer for HomeAssistant

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–æ–¥–∏–ª—Å—è –ø–æ—Å–ª–µ –±–µ–∑—É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–±—Ä–∞—Ç—å wb-mqtt-serial, libwbmqtt-dev –∏ —Ç.–ø. 

–ö–æ—Ç–æ—Ä—ã–µ, –∫–∞–∫ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å.
https://support.wirenboard.com/t/nesobiraemyj-wb-mqtt-serial-i-pr/18105

Preparing to unpack libwbmqtt-dev_1.4.2_all.deb ...
-  Package libwbmqtt0 is not installed.
-  Package libjsoncpp-dev is not installed.
- Errors were encountered while processing:
 libwbmqtt-dev 

–í–æ–±—â–µ–º, –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –ø–æ–∫—É–ø–∞—Ç—å Wiren Board –∑–∞ 25 –∫–∞—Å–æ–≤, –Ω–æ —Ö–æ—á–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∏–º–º–µ—Ä—ã WB-Led —Å–µ–±–µ –≤ HA –ø–æ—Ç—Ä–∞—Ç–∏–≤ 300—Ä –Ω–∞ esp32 –∏ 40—Ä –Ω–∞ TTL-RS485 –Ω–∞ MAX485 –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Ç–æ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–ª—è –≤–∞—Å üôè

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã YAML –¥–ª—è –¥–∏–º–º–µ—Ä–æ–≤ **Wiren Board WB-LED** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ ESP32 –∏ **ESPHome** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ HomeAssistant

## üß† –ò–¥–µ—è

–ö–∞–∂–¥—ã–π WB-LED –¥–∏–º–º–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ Modbus –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç **4 –∫–∞–Ω–∞–ª–∞**. 
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–º–º–µ—Ä–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —à–∞–±–ª–æ–Ω—É —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä `wb1`, `wb2`, ...), 
–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–º–µ—Ä–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã.

–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±—Ä–æ—Å —Å–æ–±—ã—Ç–∏–π –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –∏ —Å–æ–±—ã—Ç–∏—è –∫–æ—Ä–æ—Ç–∫–æ–µ+–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤ HA/
–Ø—Ä–∫–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç—É—Å —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å HA.

## üìå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ESP32:
| MAX485 | ESP32                          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                |
|--------|--------------------------------|-------------------------------------------|
| RO     | RX (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPIO16)          | –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (ESP32 —á–∏—Ç–∞–µ—Ç)               |
| DI     | TX (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPIO17)          | –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö (ESP32 –ø–∏—à–µ—Ç)             |
| RE     | GPIO (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPIO4)         | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–º –ø—Ä–∏–µ–º–∞/–ø–µ—Ä–µ–¥–∞—á–∏        |
| DE     | GPIO (–Ω–∞–ø—Ä–∏–º–µ—Ä, GPIO4)         | –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å RE                     |
| VCC    | 3.3V –∏–ª–∏ 5V*                   | –ü–∏—Ç–∞–Ω–∏–µ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥—É–ª—è)         |
| GND    | GND                            | –û–±—â–∏–π –º–∏–Ω—É—Å                               |
| A / B  | RS-485 —à–∏–Ω–∞                    | –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ RS-485                    |


## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–º–º–µ—Ä–∞ WB-LED
–î–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–º–º–µ—Ä–∞ —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä–æ–≥—Ä–∞–º–º—É RilhevaModbusPoll
–ö–æ–Ω—Ñ–∏–≥ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º—ã wb-led.rilmp —Ç–∞–∫–∂–µ –≤ —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.


## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–º–º–µ—Ä–æ–≤ –≤ `generate_esp32_yaml.py`:
- –¢–∞–∫–∂–µ –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏ –∫ –ø–æ—Ä—Ç–∞–º GPIO, –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è 4—Ö —Ç–∏–ø–æ–≤ –Ω–∞–∂–∞—Ç–∏–π –≤ HA.
BTN_GPIO_LIST = [0, 2, 4, 5, 12, 13, 14]
—ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–∞ GPIO0, GPIO2 ... –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä –æ—Ç –∫–ª–∏–∫–æ–≤—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–Ω—ã—Ö –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–µ–π) 

```python
prefixes = ['wb1', 'wb2', 'wb3']
```

- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:
```python generate_esp32_yaml.py```

–°–∫—Ä–∏–ø—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–º–º–µ—Ä–∞ –≤ build/wbX/ –∏ firmware.yaml –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å —á–µ—Ä–µ–∑ esphome 

